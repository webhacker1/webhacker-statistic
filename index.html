<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Statistics Library Demo</title>
    <style>
      body {
        margin: 0;
        padding: 20px;
        background: #f3f7fc;
        font-family: "Segoe UI", Arial, sans-serif;
      }

      .grid {
        display: grid;
        grid-template-columns: repeat(2, minmax(280px, 1fr));
        gap: 16px;
      }

      .card {
        background: #fff;
        border: 1px solid #dbe7f5;
        border-radius: 14px;
        padding: 12px;
      }

      .wide {
        grid-column: span 2;
      }

      .canvas-wrap {
        height: 320px;
      }

      @media (max-width: 900px) {
        .grid {
          grid-template-columns: 1fr;
        }

        .wide {
          grid-column: auto;
        }
      }
    </style>
  </head>
  <body>
    <h2>Chart Library Demo</h2>

    <div class="period-selector" style="margin-bottom: 12px;">
      <button class="chip active" data-period="7">7</button>
      <button class="chip" data-period="30">30</button>
      <button class="chip" data-period="all">All</button>
    </div>

    <div class="grid">
      <div class="card">
        <h3>Doughnut</h3>
        <div class="canvas-wrap"><canvas id="stepPie"></canvas></div>
      </div>

      <div class="card">
        <h3>Bars</h3>
        <div class="canvas-wrap"><canvas id="structureBar"></canvas></div>
      </div>

      <div class="card wide">
        <h3>Line</h3>
        <div class="canvas-wrap"><canvas id="activityChart"></canvas></div>
      </div>
    </div>

    <hr style="margin: 24px 0;" />

    <div class="grid">
      <div class="card">
        <h3>Completion</h3>
        <div class="canvas-wrap"><canvas id="successRatioChart"></canvas></div>
      </div>
      <div class="card">
        <h3>Radar</h3>
        <div class="canvas-wrap"><canvas id="answersRadarChart"></canvas></div>
      </div>
    </div>

    <script src="./dist/webhacker-statistic.bundle.js"></script>
    <script>
      const API = window.WebHackerStatistics;

      const timelineRows = [
        { date: "2026-01-28", a: 2, b: 0 },
        { date: "2026-01-29", a: 2, b: 0 },
        { date: "2026-02-01", a: 1, b: 0 },
        { date: "2026-02-05", a: 13, b: 2 },
        { date: "2026-02-06", a: 4, b: 1 },
        { date: "2026-02-11", a: 2, b: 0 }
      ].map(item => ({ ...item, dateObject: new Date(`${item.date}T00:00`) }));

      function byPeriod(period) {
        if (period === "all") return [...timelineRows];
        const days = Number(period) || 7;
        const cutoff = new Date(new Date().setHours(0, 0, 0, 0) - (days - 1) * 864e5);
        return timelineRows.filter(item => item.dateObject >= cutoff);
      }

      function drawLine(period) {
        const rows = byPeriod(period).sort((a, b) => a.dateObject - b.dateObject);
        API.renderLineChart({
          canvasElement: document.getElementById("activityChart"),
          labels: rows.map(item => item.dateObject.toLocaleDateString("ru-RU", { day: "2-digit", month: "2-digit" })),
          series: [
            { identifier: "a", label: "Series A", values: rows.map(item => item.a) },
            { identifier: "b", label: "Series B", values: rows.map(item => item.b) }
          ],
          options: { enableLegend: true }
        });
      }

      document.querySelectorAll(".period-selector .chip").forEach(buttonElement => {
        buttonElement.addEventListener("click", () => {
          document.querySelectorAll(".period-selector .chip").forEach(chip => chip.classList.remove("active"));
          buttonElement.classList.add("active");
          drawLine(buttonElement.dataset.period || "7");
        });
      });

      API.renderDoughnutChart({
        canvasElement: document.getElementById("stepPie"),
        labels: ["Text", "Video", "Quiz", "Blank", "Matching"],
        values: [8, 6, 17, 2, 5],
        options: {
          valueLabel: "Count",
          shareLabel: "Share",
          enableLegend: true
        }
      });

      API.renderBarChart({
        canvasElement: document.getElementById("structureBar"),
        labels: ["Modules", "Lessons", "Steps"],
        values: [6, 7, 34],
        options: {
          valueLabel: "Count",
          enableLegend: true
        }
      });

      API.renderDoughnutChart({
        canvasElement: document.getElementById("successRatioChart"),
        labels: ["Passed", "Failed"],
        values: [119, 33],
        colors: ["#28a745", "#e74c3c"],
        cutoutRatio: 0.58,
        options: {
          valueLabel: "Count",
          shareLabel: "Share",
          enableLegend: true
        }
      });

      API.renderRadarChart({
        canvasElement: document.getElementById("answersRadarChart"),
        labels: ["Text", "Video", "Quiz", "Blank", "Matching"],
        values: [8, 6, 17, 2, 5],
        options: {
          valueLabel: "Votes",
          noDataLabel: "No data"
        }
      });

      drawLine("7");
    </script>
  </body>
</html>

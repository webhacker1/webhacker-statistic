<!doctype html>
<html lang="ru">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>WebHackerStatistics v2 Demo</title>
    <style>
      body {
        margin: 0;
        padding: 20px;
        background: linear-gradient(180deg, #eef5ff 0%, #f7fbff 100%);
        font-family: "Segoe UI", system-ui, -apple-system, sans-serif;
      }

      .toolbar {
        display: flex;
        align-items: center;
        gap: 8px;
        flex-wrap: wrap;
        margin-bottom: 14px;
      }

      .toolbar button {
        border: 1px solid #b9d2f2;
        background: #ffffff;
        border-radius: 999px;
        padding: 7px 12px;
        cursor: pointer;
      }

      .toolbar button:hover {
        background: #f2f8ff;
      }

      .toolbar button.active {
        border-color: #2f89ff;
        color: #2f89ff;
        font-weight: 600;
      }
    </style>
  </head>
  <body>
    <div class="statistics-widget-root">
      <h1 style="margin: 0 0 12px; font-size: 22px; color: #1f2d3d">WebHackerStatistics v2</h1>

      <div class="toolbar" id="periodControls">
        <button data-days="7" class="active">7 дней</button>
        <button data-days="30">30 дней</button>
        <button data-days="90">90 дней</button>
        <button id="shuffleData">Перемешать данные</button>
      </div>

      <div class="wh-dashboard">
        <article class="wh-card">
          <h3>Посещения по дням</h3>
          <div class="wh-canvas-wrap"><canvas id="lineStat"></canvas></div>
        </article>

        <article class="wh-card">
          <h3>Структура курса</h3>
          <div class="wh-canvas-wrap"><canvas id="barStat"></canvas></div>
        </article>

        <article class="wh-card wh-card--wide">
          <h3>Распределение типов заданий</h3>
          <div class="wh-canvas-wrap"><canvas id="doughnutStat"></canvas></div>
        </article>

        <article class="wh-card">
          <h3>Профиль навыков</h3>
          <div class="wh-canvas-wrap"><canvas id="radarStat"></canvas></div>
        </article>
      </div>
    </div>

    <script src="./dist/webhacker-statistic.bundle.js"></script>
    <script>
      const { Statistic } = window.WebHackerStatistics;

      const activityRows = Array.from({ length: 90 }, (_, index) => {
        const date = new Date();
        date.setDate(date.getDate() - (89 - index));
        return {
          date,
          joins: Math.floor(8 + Math.random() * 44),
          leaves: Math.floor(1 + Math.random() * 10)
        };
      });

      const lineStat = new Statistic(document.getElementById("lineStat"), {
        type: "line",
        data: {
          labels: [],
          datasets: [
            {
              label: "Зашли",
              data: [],
              borderColor: "#2f89ff",
              backgroundColor: "rgba(47,137,255,0.20)",
              fill: true,
              tension: 0.35,
              pointRadius: 3
            },
            {
              label: "Вышли",
              data: [],
              borderColor: "#ff6a55",
              backgroundColor: "rgba(255,106,85,0.14)",
              fill: true,
              tension: 0.35,
              pointRadius: 3
            }
          ]
        },
        options: {
          animation: { duration: 1000 },
          plugins: { legend: { display: true } }
        }
      });

      const barStat = new Statistic(document.getElementById("barStat"), {
        type: "bar",
        data: {
          labels: ["Модули", "Уроки", "Шаги"],
          datasets: [
            {
              label: "Количество",
              data: [6, 14, 49],
              backgroundColor: ["#36A2EB", "#4BC0C0", "#8BC34A"]
            }
          ]
        },
        options: {
          animation: { duration: 850 },
          plugins: { legend: { display: false } }
        }
      });

      const doughnutStat = new Statistic(document.getElementById("doughnutStat"), {
        type: "doughnut",
        data: {
          labels: ["Текст", "Видео", "Тест", "Blank", "Matching"],
          datasets: [
            {
              data: [18, 11, 28, 4, 9],
              backgroundColor: ["#36A2EB", "#FF6384", "#FFCE56", "#4BC0C0", "#9966FF"]
            }
          ]
        },
        options: {
          cutout: "60%",
          animation: { duration: 900 },
          plugins: { legend: { display: true } }
        }
      });

      const radarStat = new Statistic(document.getElementById("radarStat"), {
        type: "radar",
        data: {
          labels: ["Логика", "Практика", "Теория", "Скорость", "Коммуникация"],
          datasets: [
            {
              label: "Текущий уровень",
              data: [72, 61, 84, 57, 66],
              borderColor: "#2f89ff",
              backgroundColor: "rgba(47,137,255,0.18)",
              fill: true
            },
            {
              label: "Целевой уровень",
              data: [85, 82, 90, 74, 80],
              borderColor: "#ff9f40",
              backgroundColor: "rgba(255,159,64,0.10)",
              fill: true
            }
          ]
        },
        options: {
          animation: { duration: 920 },
          plugins: { legend: { display: true } }
        }
      });

      function applyPeriod(days) {
        const rows = activityRows.slice(-days);
        lineStat.update({
          type: "line",
          data: {
            labels: rows.map(item => item.date.toLocaleDateString("ru-RU", { day: "2-digit", month: "2-digit" })),
            datasets: [
              {
                label: "Зашли",
                data: rows.map(item => item.joins),
                borderColor: "#2f89ff",
                backgroundColor: "rgba(47,137,255,0.20)",
                fill: true,
                tension: 0.35,
                pointRadius: 3
              },
              {
                label: "Вышли",
                data: rows.map(item => item.leaves),
                borderColor: "#ff6a55",
                backgroundColor: "rgba(255,106,85,0.14)",
                fill: true,
                tension: 0.35,
                pointRadius: 3
              }
            ]
          },
          options: {
            animation: { duration: 760 },
            plugins: { legend: { display: true } }
          }
        });
      }

      document.querySelectorAll("#periodControls button[data-days]").forEach(button => {
        button.addEventListener("click", () => {
          document
            .querySelectorAll("#periodControls button[data-days]")
            .forEach(item => item.classList.remove("active"));

          button.classList.add("active");
          applyPeriod(Number(button.dataset.days));
        });
      });

      document.getElementById("shuffleData").addEventListener("click", () => {
        const current = barStat.getConfig();
        const next = current.data.datasets[0].data.map(() => Math.floor(4 + Math.random() * 60));

        barStat.update({
          ...current,
          data: {
            ...current.data,
            datasets: [
              {
                ...current.data.datasets[0],
                data: next
              }
            ]
          }
        });
      });

      applyPeriod(7);
    </script>
  </body>
</html>

